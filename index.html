<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Streamcenter | Pixelsport Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Oxanium', sans-serif; background-color: #05070a; color: #ffffff; }
        .match-card { background: linear-gradient(180deg, #11141d 0%, #05070a 100%); border: 1px solid rgba(255,255,255,0.05); transition: 0.3s ease; }
        .match-card:hover { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.1); }
        .live-tag { background: #ef4444; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .video-container { background: #000; width: 100%; aspect-ratio: 16/9; }
        .btn-server { transition: all 0.2s; }
        .btn-server:hover { transform: scale(1.02); }
    </style>
</head>
<body class="pb-10">

    <nav class="bg-black/90 border-b border-white/10 sticky top-0 z-50 backdrop-blur-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white font-black px-2 py-0.5 rounded text-xs tracking-tighter">LIVE</div>
                <h1 class="font-bold tracking-tighter text-xl text-blue-500">STREAMCENTER</h1>
            </div>
            <button onclick="fetchEvents()" class="p-2 bg-white/5 rounded-lg hover:bg-white/10 text-slate-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-8">
        <div id="cors-notice" class="hidden bg-yellow-500/10 border border-yellow-500/50 rounded-xl p-4 mb-6 text-center">
            <p class="text-yellow-500 text-xs font-bold uppercase mb-2">⚠️ Connection Restricted</p>
            <p class="text-slate-400 text-[10px]">Please click <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank" class="text-blue-400 underline uppercase">Enable Proxy Access</a> then refresh this page.</p>
        </div>

        <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-20">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-blue-500 mb-4"></div>
                <p class="text-slate-500 text-[10px] uppercase tracking-widest">Scanning Satellite Feeds...</p>
            </div>
        </div>
    </main>

    <div id="player-modal" class="fixed inset-0 z-[100] hidden bg-black/98 flex-col items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <div id="playing-title" class="font-bold text-blue-400 uppercase text-sm tracking-tight"></div>
                <button onclick="closePlayer()" class="text-white hover:text-red-500 text-xl font-bold">✕</button>
            </div>
            <div class="video-container rounded-xl overflow-hidden border border-white/10 shadow-2xl shadow-blue-500/10">
                <video id="video-player" controls playsinline></video>
            </div>
            <div class="mt-4 flex gap-2">
                <span class="text-[9px] bg-blue-500/10 text-blue-400 px-2 py-1 rounded border border-blue-500/20">HTTPS REFERRER BYPASS ACTIVE</span>
                <span class="text-[9px] bg-white/5 text-slate-500 px-2 py-1 rounded border border-white/10">HLS V3</span>
            </div>
        </div>
    </div>

    <script>
        // We use a backup proxy if the first one fails
        const PROXY_URL = "https://cors-anywhere.herokuapp.com/";
        const API_URL = 'https://pixelsport.tv/backend/liveTV/events';

        async function fetchEvents() {
            const grid = document.getElementById('events-grid');
            const notice = document.getElementById('cors-notice');

            try {
                // Try fetching through the proxy
                const response = await fetch(PROXY_URL + API_URL);
                if (!response.ok) throw new Error('CORS Access Required');

                const data = await response.json();
                notice.classList.add('hidden');
                renderEvents(data.events);
            } catch (err) {
                console.error("CORS Blocked:", err);
                notice.classList.remove('hidden');
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20 border-2 border-dashed border-white/5 rounded-3xl">
                        <div class="text-red-500 font-black text-4xl mb-4 italic uppercase">Signal Lost</div>
                        <p class="text-slate-500 text-xs uppercase tracking-widest">CORS Restriction Active</p>
                        <button onclick="window.open('https://cors-anywhere.herokuapp.com/corsdemo', '_blank')" class="mt-6 bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-full font-black text-xs uppercase transition-all shadow-lg shadow-blue-900/40">
                            Unlock API Signal
                        </button>
                    </div>`;
            }
        }

        function renderEvents(events) {
            const grid = document.getElementById('events-grid');
            grid.innerHTML = '';

            if (!events || events.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center text-slate-500 uppercase text-[10px]">No matches found in satellite schedule</p>`;
                return;
            }

            events.forEach(event => {
                const card = document.createElement('div');
                card.className = "match-card rounded-2xl p-6 flex flex-col gap-4";
                
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-tighter">${event.channel.TVCategory?.name || 'Live Event'}</span>
                        <span class="live-tag text-[9px] px-2 py-0.5 rounded font-black text-white">LIVE FEED</span>
                    </div>

                    <div class="flex items-center justify-between py-2">
                        <div class="text-center w-1/3">
                            <img src="${event.competitors1_logo}" class="w-16 h-16 mx-auto object-contain mb-2 drop-shadow-lg">
                            <span class="text-[10px] font-bold text-slate-400 uppercase line-clamp-1">${event.competitors1_name}</span>
                        </div>
                        <div class="text-[10px] font-black text-slate-800 italic uppercase">VS</div>
                        <div class="text-center w-1/3">
                            <img src="${event.competitors2_logo}" class="w-16 h-16 mx-auto object-contain mb-2 drop-shadow-lg">
                            <span class="text-[10px] font-bold text-slate-400 uppercase line-clamp-1">${event.competitors2_name}</span>
                        </div>
                    </div>

                    <div class="text-center border-t border-white/5 pt-4">
                        <h3 class="font-bold text-sm text-white line-clamp-1 uppercase tracking-tight">${event.match_name}</h3>
                        <p class="text-[10px] font-bold text-blue-500 mt-1 uppercase">${event.location || 'Broadcast Center'}</p>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mt-2">
                        <button onclick="playStream('${event.channel.server1URL}', '${event.match_name}')" 
                            class="btn-server bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-black text-[10px] uppercase shadow-lg shadow-blue-900/20">
                            Server 1
                        </button>
                        <button onclick="playStream('${event.channel.server2URL}', '${event.match_name}')" 
                            class="btn-server bg-white/5 hover:bg-white/10 text-white py-3 rounded-xl font-black text-[10px] uppercase border border-white/10">
                            Server 2
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function playStream(url, title) {
            if (!url || url === "null") {
                alert("This satellite feed is currently offline.");
                return;
            }

            const video = document.getElementById('video-player');
            const modal = document.getElementById('player-modal');
            document.getElementById('playing-title').innerText = title;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';

            if (Hls.isSupported()) {
                const hls = new Hls({
                    xhrSetup: function(xhr, url) {
                        // Attempting to maintain origin context
                        xhr.withCredentials = false;
                    }
                });
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.addEventListener('loadedmetadata', () => video.play());
            }
        }

        function closePlayer() {
            const video = document.getElementById('video-player');
            video.pause();
            video.src = "";
            document.getElementById('player-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        fetchEvents();
    </script>
</body>
</html>
