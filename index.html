<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Streamcenter | Pixelsport Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Oxanium', sans-serif; background-color: #05070a; color: #ffffff; }
        .match-card { background: linear-gradient(180deg, #11141d 0%, #05070a 100%); border: 1px solid rgba(255,255,255,0.05); }
        .live-tag { background: #ef4444; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .video-container { background: #000; width: 100%; aspect-ratio: 16/9; }
    </style>
</head>
<body class="pb-10">

    <nav class="bg-black/90 border-b border-white/10 sticky top-0 z-50 backdrop-blur-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white font-black px-2 py-0.5 rounded text-[10px]">PHT</div>
                <h1 class="font-bold tracking-tighter text-xl text-blue-500">STREAMCENTER</h1>
            </div>
            <div id="pht-clock" class="text-[10px] font-mono text-slate-500"></div>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-8">
        <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-20">
                <p class="animate-pulse text-slate-500 text-xs uppercase tracking-widest">Connecting to Pixelsport API...</p>
            </div>
        </div>
    </main>

    <div id="player-modal" class="fixed inset-0 z-[100] hidden bg-black/98 flex-col items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="playing-title" class="font-bold text-blue-400 text-sm"></h3>
                <button onclick="closePlayer()" class="text-white hover:text-red-500 text-xl font-bold">âœ•</button>
            </div>
            <div class="video-container rounded-xl overflow-hidden border border-white/10 shadow-2xl">
                <video id="video-player" controls playsinline></video>
            </div>
        </div>
    </div>

    <script>
        // We use an open proxy to bypass CORS since your Python script works but browser fetch doesn't
        const PROXY = "https://api.allorigins.win/raw?url=";
        const API_URL = 'https://pixelsport.tv/backend/liveTV/events';

        // Update Clock (PHT)
        setInterval(() => {
            const now = new Date();
            document.getElementById('pht-clock').innerText = now.toLocaleString('en-US', { timeZone: 'Asia/Manila' });
        }, 1000);

        async function fetchEvents() {
            const grid = document.getElementById('events-grid');
            try {
                const response = await fetch(PROXY + encodeURIComponent(API_URL));
                const data = await response.json();
                renderEvents(data.events);
            } catch (err) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-red-500 font-bold uppercase">Signal Blocked. Please Refresh.</div>`;
            }
        }

        function renderEvents(events) {
            const grid = document.getElementById('events-grid');
            grid.innerHTML = '';
            
            // Filter logic from your Python script: Only show if start time is relevant
            const now = new Date();

            events.forEach(event => {
                const eventDate = new Date(event.date);
                const phtTime = eventDate.toLocaleString('en-US', { 
                    timeZone: 'Asia/Manila', 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    hour12: true 
                });

                const card = document.createElement('div');
                card.className = "match-card rounded-2xl p-5 flex flex-col gap-4";
                
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] font-bold text-slate-500 uppercase">${event.channel.TVCategory?.name || 'Live'}</span>
                        <span class="live-tag text-[9px] px-2 py-0.5 rounded font-black text-white">LIVE</span>
                    </div>

                    <div class="flex items-center justify-between py-2">
                        <div class="text-center w-5/12">
                            <img src="${event.competitors2_logo}" class="w-14 h-14 mx-auto object-contain mb-2">
                            <span class="text-[10px] font-bold text-slate-400 uppercase line-clamp-1">${event.competitors2_name}</span>
                        </div>
                        <div class="text-[10px] font-black text-slate-800">VS</div>
                        <div class="text-center w-5/12">
                            <img src="${event.competitors1_logo}" class="w-14 h-14 mx-auto object-contain mb-2">
                            <span class="text-[10px] font-bold text-slate-400 uppercase line-clamp-1">${event.competitors1_name}</span>
                        </div>
                    </div>

                    <div class="text-center border-t border-white/5 pt-3">
                        <h3 class="font-bold text-xs text-white uppercase">${event.shortName || event.match_name}</h3>
                        <p class="text-[10px] text-blue-500 mt-1 font-bold">PHT: ${phtTime}</p>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="playStream('${event.channel.server1URL}', '${event.match_name}')" 
                            class="bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg font-bold text-[10px] uppercase">
                            Server 1
                        </button>
                        <button onclick="playStream('${event.channel.server2URL}', '${event.match_name}')" 
                            class="bg-white/5 hover:bg-white/10 text-white py-2 rounded-lg font-bold text-[10px] uppercase border border-white/10">
                            Server 2
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function playStream(url, title) {
            if (!url || url === "null") return alert("Feed Offline");
            const video = document.getElementById('video-player');
            document.getElementById('playing-title').innerText = title;
            document.getElementById('player-modal').classList.replace('hidden', 'flex');

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else {
                video.src = url;
                video.play();
            }
        }

        function closePlayer() {
            const video = document.getElementById('video-player');
            video.pause();
            video.src = "";
            document.getElementById('player-modal').classList.replace('flex', 'hidden');
        }

        fetchEvents();
    </script>
</body>
</html>
