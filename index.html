<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>Streamcenter | By RageTV</title>
<link rel="icon" href="logo.png">

<style>
  body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #050505; color: #fff; margin: 0; padding: 0; }
  
  header { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    background-color: #0f0f0f; 
    padding: 20px 15px; 
    border-bottom: 1px solid #1f1f1f;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .logo-area { text-align: center; margin-bottom: 15px; }
  .logo-area h1 { margin: 0; font-size: 28px; font-weight: 900; letter-spacing: -1.5px; font-style: italic; }
  .logo-area span { color: #3b82f6; }
  .logo-area p { margin: 0; font-size: 10px; text-transform: uppercase; letter-spacing: 4px; opacity: 0.6; font-weight: bold; }

  #searchBar {
    width: 90%; max-width: 600px; padding: 12px 25px; border-radius: 30px;
    border: 1px solid #2a2a2a; background: #181818; color: #fff; font-size: 14px; outline: none; transition: 0.3s ease;
  }
  #searchBar:focus { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); background: #202020; }

  .category-title {
    margin: 35px 20px 15px; font-size: 14px; border-left: 3px solid #3b82f6; padding-left: 12px;
    text-transform: uppercase; letter-spacing: 2px; color: #888; font-weight: 800;
  }
  
  .live-title { border-left-color: #ef4444; color: #ef4444; }

  .container {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px; padding: 0 20px 30px;
  }

  .card {
    background: #121212; border-radius: 14px; overflow: hidden;
    position: relative; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    cursor: pointer; border: 1px solid #1f1f1f;
  }
  .card:hover { transform: translateY(-8px); border-color: #3b82f6; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  
  .card img { width: 100%; height: 180px; object-fit: cover; opacity: 0.6; transition: 0.4s; }
  .card:hover img { opacity: 0.9; }

  .live-badge {
    background: #ef4444; color: white; font-size: 10px; padding: 4px 10px;
    border-radius: 5px; position: absolute; top: 15px; left: 15px; font-weight: 900; z-index: 10;
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); animation: pulse 1.5s infinite;
  }

  .info { padding: 18px; }
  .category-label { font-size: 11px; font-weight: 800; color: #3b82f6; text-transform: uppercase; margin-bottom: 6px; }
  .title { font-size: 17px; font-weight: 700; margin-bottom: 12px; line-height: 1.3; height: 44px; overflow: hidden; }
  
  .details { font-size: 12px; opacity: 0.6; margin-top: 6px; display: flex; align-items: center; gap: 8px; }
  
  .timer { 
    font-size: 12px; font-weight: 700; background: rgba(59, 130, 246, 0.1); 
    color: #3b82f6; padding: 6px 12px; border-radius: 6px; display: inline-block; margin-top: 10px;
  }
  .timer.soon { background: rgba(16, 185, 129, 0.1); color: #10b981; }

  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

  #playerContainer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: none; background: #000; z-index: 9999;
  }
  #player { width: 100%; height: 100%; border: none; }
  #closeBtn {
    position: absolute; top: 20px; right: 20px; background: #ef4444;
    color: #fff; border: none; padding: 10px 20px; font-size: 13px; font-weight: bold;
    border-radius: 8px; cursor: pointer; z-index: 10000; text-transform: uppercase;
  }
</style>
</head>

<body>
<header>
  <div class="logo-area">
      <h1>STREAM<span>CENTER</span></h1>
      <p>By RageTV</p>
  </div>
  <input type="text" id="searchBar" placeholder="Search events, teams, or leagues...">
</header>

<div id="streamsContainer"></div>

<div id="playerContainer">
  <button id="closeBtn">Close Stream</button>
  <iframe id="player" allowfullscreen allow="autoplay; encrypted-media"></iframe>
</div>

<script>
let allStreams = [];
// Direct API URL without Proxy
const API_URL = "https://api.ppv.to/api/streams";

async function loadStreams() {
  try {
    // Direct fetch call
    const res = await fetch(API_URL);
    const data = await res.json();

    allStreams = [];
    data.forEach(cat => {
      const filtered = cat.streams.filter(s =>
        !s.name.toLowerCase().includes("24/7") &&
        !s.name.toLowerCase().includes("test")
      );
      if (filtered.length > 0) {
        allStreams.push({ category: cat.category, streams: filtered });
      }
    });

    displayStreams(allStreams);
  } catch (error) {
    console.error("Direct Fetch Failed (Likely CORS):", error);
    document.getElementById("streamsContainer").innerHTML = `
        <div style="text-align:center; padding-top:100px;">
            <p style="color:#ef4444; font-weight:bold;">CONNECTION BLOCKED</p>
            <p style="font-size:12px; color:#555;">Browser security (CORS) is preventing direct access to the API.</p>
        </div>`;
  }
}

function displayStreams(groups) {
  const container = document.getElementById("streamsContainer");
  container.innerHTML = "";
  const now = Math.floor(Date.now() / 1000);

  const live = [];
  const upcomingGroups = [];

  groups.forEach(group => {
    const upcoming = [];
    group.streams.forEach(s => {
      const isLive = now >= s.starts_at && now <= s.ends_at;
      s.category = group.category;
      if (isLive) live.push(s);
      else upcoming.push(s);
    });
    if (upcoming.length > 0) upcomingGroups.push({ category: group.category, streams: upcoming });
  });

  if (live.length > 0) {
    createSection(container, "ðŸ”´ Live Now", live, true);
  }

  upcomingGroups.forEach(group => {
    createSection(container, group.category, group.streams, false);
  });
}

function createSection(parent, titleText, streams, isLiveSection) {
    const title = document.createElement("h2");
    title.className = "category-title" + (isLiveSection ? " live-title" : "");
    title.textContent = titleText;
    parent.appendChild(title);

    const grid = document.createElement("div");
    grid.className = "container";
    streams.forEach(s => grid.appendChild(createCard(s, isLiveSection)));
    parent.appendChild(grid);
}

function formatPHT(unix) {
  return new Date(unix * 1000).toLocaleString('en-US', { 
    timeZone: 'Asia/Manila', 
    month: 'short', day: '2-digit', 
    hour: '2-digit', minute: '2-digit', hour12: true 
  });
}

function createCard(stream, isLive) {
  const card = document.createElement("div");
  card.className = "card";
  card.dataset.startTime = stream.starts_at;

  const img = document.createElement("img");
  img.src = stream.poster;

  const info = document.createElement("div");
  info.className = "info";

  const category = document.createElement("div");
  category.className = "category-label";
  category.textContent = stream.category;

  const title = document.createElement("div");
  title.className = "title";
  title.textContent = stream.name;

  const details = document.createElement("div");
  details.className = "details";
  details.innerHTML = `<span>ðŸ“… PHT: ${formatPHT(stream.starts_at)}</span> â€¢ <span>ðŸ“º ${stream.tag}</span>`;

  const timer = document.createElement("div");
  timer.className = "timer";

  if (isLive) {
    const badge = document.createElement("div");
    badge.className = "live-badge";
    badge.textContent = "LIVE";
    card.appendChild(badge);
    timer.style.display = "none";
  } else {
    updateTimer(timer, stream.starts_at);
  }

  info.appendChild(category);
  info.appendChild(title);
  info.appendChild(details);
  info.appendChild(timer);

  card.appendChild(img);
  card.appendChild(info);

  card.addEventListener("click", () => {
      document.getElementById("playerContainer").style.display = "block";
      document.getElementById("player").src = stream.iframe + "?noads=true";
      document.body.style.overflow = "hidden";
  });

  return card;
}

function updateTimer(el, startTime) {
  const now = Math.floor(Date.now() / 1000);
  const diff = startTime - now;

  if (diff <= 0) {
    el.textContent = "STARTED";
    el.classList.add("soon");
    return;
  }

  const hrs = Math.floor(diff / 3600);
  const mins = Math.floor((diff % 3600) / 60);
  
  if (hrs > 24) {
      el.textContent = `Starts in ${Math.floor(hrs/24)}d ${hrs%24}h`;
  } else {
      el.textContent = `Starts in ${hrs}h ${mins}m`;
  }
  
  if (diff <= 3600) el.classList.add("soon");
}

document.getElementById("closeBtn").addEventListener("click", () => {
  document.getElementById("player").src = "";
  document.getElementById("playerContainer").style.display = "none";
  document.body.style.overflow = "auto";
});

document.getElementById("searchBar").addEventListener("input", (e) => {
  const term = e.target.value.toLowerCase();
  if (!term) return displayStreams(allStreams);

  const filtered = allStreams.map(group => {
    const streams = group.streams.filter(s =>
      s.name.toLowerCase().includes(term) ||
      group.category.toLowerCase().includes(term)
    );
    return { category: group.category, streams };
  }).filter(g => g.streams.length > 0);

  displayStreams(filtered);
});

loadStreams();
setInterval(() => {
    document.querySelectorAll(".timer").forEach(el => {
        const card = el.closest(".card");
        if (card && card.dataset.startTime) {
            updateTimer(el, parseInt(card.dataset.startTime));
        }
    });
}, 60000);
</script>
</body>
</html>
