<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamcenter | Live Sports by RageTV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Oxanium', sans-serif; background-color: #0b0f1a; color: #ffffff; overflow-x: hidden; }
        .sport-card { background: linear-gradient(145deg, #161b2c, #0b0f1a); transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.1); }
        .card-live { border: 1px solid #0ea5e9 !important; box-shadow: 0 0 20px rgba(14, 165, 233, 0.15); }
        .card-scheduled { opacity: 0.5; }
        .live-dot { width: 8px; height: 8px; background-color: #ef4444; border-radius: 50%; display: inline-block; margin-right: 5px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-filter { background-color: #38bdf8 !important; color: #000 !important; }
    </style>
</head>
<body class="pb-20">

    <nav class="bg-black/90 backdrop-blur-xl border-b border-white/10 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="https://streamcenter.pro/logo.png" alt="Logo" class="h-10">
                <div class="leading-tight">
                    <h1 class="font-bold text-lg uppercase tracking-wider">Streamcenter</h1>
                    <p class="text-[10px] text-sky-400 font-bold uppercase tracking-[0.2em]">By RageTV</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span id="clock" class="text-[10px] font-mono text-slate-400 hidden md:block"></span>
                <button onclick="init()" class="p-2 bg-white/5 rounded-full hover:bg-sky-500 hover:text-black transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <div class="bg-slate-900 border-b border-white/5 overflow-x-auto no-scrollbar">
        <div id="category-list" class="container mx-auto px-4 py-4 flex gap-4"></div>
    </div>

    <main class="container mx-auto px-4 py-8">
        <div id="parties-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="col-span-full text-center py-20 text-slate-500 uppercase tracking-widest text-xs">
                Establishing Secure Connection...
            </div>
        </div>
    </main>

    <div id="video-modal" class="fixed inset-0 z-[100] hidden bg-black/98 items-center justify-center p-4">
        <div class="relative w-full max-w-5xl aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-white/10">
            <button onclick="closePlayer()" class="absolute top-4 right-4 z-[110] bg-white/10 hover:bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all border border-white/20">âœ•</button>
            <iframe id="player-frame" src="" class="w-full h-full" frameborder="0" allowfullscreen sandbox="allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation"></iframe>
        </div>
    </div>

    <script>
        const API_PARTIES = 'https://backend.streamcenter.live/api/Parties?pageNumber=1&pageSize=50';
        const API_CATEGORIES = 'https://backend.streamcenter.live/api/Categories';
        const API_PPV = 'https://api.ppv.to/api/streams';

        let allParties = [];
        let allCategories = [];
        let currentFilter = 'all';

        // Update Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
        }, 1000);

        async function init() {
            const grid = document.getElementById('parties-grid');
            try {
                const [catRes, partyRes] = await Promise.all([
                    fetch(API_CATEGORIES),
                    fetch(API_PARTIES)
                ]);
                
                allCategories = await catRes.json();
                allParties = await partyRes.json();
                
                renderCategories();
                renderMatches(allParties);
            } catch (err) { 
                console.error("Connection Error:", err);
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="text-red-500 font-bold uppercase mb-4 text-xl">Signal Lost</div>
                        <p class="text-slate-500 text-sm mb-6">Failed to sync with the backend server.</p>
                        <button onclick="init()" class="bg-sky-600 px-6 py-2 rounded-full font-bold uppercase text-xs">Try Reconnect</button>
                    </div>`;
            }
        }

        function renderCategories() {
            const container = document.getElementById('category-list');
            container.innerHTML = `<button onclick="filter('all')" class="cat-btn active-filter border border-white/10 px-5 py-2 rounded-full text-xs font-bold uppercase transition">All Sports</button>`;
            allCategories.forEach(cat => {
                container.innerHTML += `<button onclick="filter(${cat.id})" class="cat-btn bg-white/5 border border-white/10 px-5 py-2 rounded-full text-xs font-bold uppercase hover:border-sky-500 transition">${cat.name}</button>`;
            });
        }

        function filter(id) {
            currentFilter = id;
            const filtered = id === 'all' ? allParties : allParties.filter(m => m.categoryId === id);
            renderMatches(filtered);
            
            // UI Toggle
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active-filter'));
            event.target.classList.add('active-filter');
        }

        function renderMatches(parties) {
            const grid = document.getElementById('parties-grid');
            grid.innerHTML = '';
            const now = new Date();

            parties.forEach(match => {
                // ADJUSTING TIME: The API is 1 day ahead, so we subtract 24 hours.
                const startTime = new Date(new Date(match.beginPartie).getTime() - 86400000);
                const endTime = new Date(new Date(match.endPartie).getTime() - 86400000);
                
                // IS LIVE LOGIC: Check if current local time is within the start/end window
                const isLive = now >= startTime && now <= endTime;

                const cleanUrl = match.videoUrl.split('<')[0].trim();
                const card = document.createElement('div');
                card.className = `sport-card rounded-2xl p-5 flex flex-col gap-4 ${isLive ? 'card-live' : 'card-scheduled'}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-center text-[10px] font-bold uppercase">
                        <span class="text-slate-500">${match.gameName || 'Broadcast'}</span>
                        ${isLive ? '<span class="text-sky-400 flex items-center"><span class="live-dot"></span>ON AIR</span>' : '<span class="text-slate-600">OFFLINE</span>'}
                    </div>

                    <div class="flex items-center justify-around py-4">
                        <img src="${match.logoTeam1}" class="w-14 h-14 object-contain" onerror="this.src='https://streamcenter.pro/logo.png'">
                        <div class="text-[10px] font-black text-slate-800 italic">VS</div>
                        <img src="${match.logoTeam2}" class="w-14 h-14 object-contain" onerror="this.src='https://streamcenter.pro/logo.png'">
                    </div>

                    <div class="text-center">
                        <h3 class="font-bold text-sm text-sky-100 line-clamp-1 uppercase tracking-tighter">${match.name}</h3>
                        <p class="text-[10px] text-slate-500 mt-2">
                            ${isLive ? 'LIVE FROM PHILIPPINES' : 'STARTS: ' + startTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true})}
                        </p>
                    </div>

                    ${isLive 
                        ? `<button onclick="openPlayer('${cleanUrl}')" class="bg-sky-600 hover:bg-sky-400 text-white hover:text-black py-3 rounded-xl font-black uppercase text-[11px] transition-all">ENTER STREAM</button>`
                        : `<button disabled class="bg-white/5 text-slate-600 py-3 rounded-xl font-black uppercase text-[11px] cursor-not-allowed border border-white/5 uppercase">Coming Soon</button>`
                    }
                `;
                grid.appendChild(card);
            });
        }

        function openPlayer(url) {
            document.getElementById('player-frame').src = url;
            document.getElementById('video-modal').classList.remove('hidden');
            document.getElementById('video-modal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closePlayer() {
            document.getElementById('player-frame').src = "";
            document.getElementById('video-modal').classList.add('hidden');
            document.getElementById('video-modal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        init();
    </script>
</body>
</html>
