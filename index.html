<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Streamcenter | PPV Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Oxanium', sans-serif; background-color: #06080f; color: #ffffff; }
        .stream-card { background: #111521; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; overflow: hidden; }
        .stream-card:hover { border-color: #3b82f6; transform: translateY(-2px); }
        .live-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; display: inline-block; margin-right: 6px; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .poster-wrapper { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; }
        iframe { width: 100%; height: 100%; background: #000; }
    </style>
</head>
<body class="pb-10">

    <nav class="bg-black/90 border-b border-white/10 sticky top-0 z-50 backdrop-blur-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-red-600 text-white font-black px-2 py-0.5 rounded text-[10px]">PPV</div>
                <h1 class="font-bold tracking-tighter text-xl text-white">STREAMCENTER</h1>
            </div>
            <div id="pht-time" class="text-[10px] font-mono text-slate-400"></div>
        </div>
    </nav>

    <main class="container mx-auto px-4 mt-8">
        <div id="streams-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-20">
                <p class="animate-pulse text-slate-500 text-xs uppercase tracking-widest">Scanning PPV Satellites...</p>
            </div>
        </div>
    </main>

    <div id="player-modal" class="fixed inset-0 z-[100] hidden bg-black flex-col items-center justify-center">
        <div class="w-full h-full flex flex-col">
            <div class="flex justify-between items-center p-4 bg-black/50 border-b border-white/10">
                <h3 id="playing-name" class="font-bold text-sm text-blue-400"></h3>
                <button onclick="closePlayer()" class="text-white bg-white/10 px-4 py-1 rounded-full hover:bg-red-600 transition">CLOSE</button>
            </div>
            <div class="flex-grow">
                <iframe id="player-iframe" src="" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.ppv.to/api/streams';
        const PROXY = 'https://api.allorigins.win/raw?url=';

        // PHT Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('pht-time').innerText = now.toLocaleString('en-US', { timeZone: 'Asia/Manila' });
        }, 1000);

        async function fetchStreams() {
            const grid = document.getElementById('streams-grid');
            try {
                const response = await fetch(PROXY + encodeURIComponent(API_URL));
                const data = await response.json();
                
                // PPV.to returns categories. We need to flatten the streams into one list.
                let allStreams = [];
                data.forEach(cat => {
                    cat.streams.forEach(stream => {
                        allStreams.push(stream);
                    });
                });

                renderStreams(allStreams);
            } catch (err) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-red-500 font-bold uppercase">CORS Connection Error. Check Proxy.</div>`;
            }
        }

        function renderStreams(streams) {
            const grid = document.getElementById('streams-grid');
            grid.innerHTML = '';
            
            const nowUnix = Math.floor(Date.now() / 1000);

            streams.forEach(stream => {
                const isLive = nowUnix >= stream.starts_at && nowUnix <= stream.ends_at;
                const startTimePHT = new Date(stream.starts_at * 1000).toLocaleString('en-US', { 
                    timeZone: 'Asia/Manila', 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    hour12: true 
                });

                const card = document.createElement('div');
                card.className = `stream-card rounded-xl ${isLive ? 'border-blue-500/50' : 'opacity-80'}`;
                
                card.innerHTML = `
                    <div class="poster-wrapper">
                        <img src="${stream.poster}" class="w-full h-full object-cover">
                        <div class="absolute top-3 left-3 flex gap-2">
                            <span class="bg-black/80 px-2 py-1 rounded text-[9px] font-bold text-white uppercase">${stream.category_name}</span>
                            <span class="bg-blue-600/90 px-2 py-1 rounded text-[9px] font-bold text-white uppercase">${stream.tag}</span>
                        </div>
                        ${isLive ? `
                            <div class="absolute bottom-3 right-3 bg-red-600 px-2 py-1 rounded text-[9px] font-black text-white">
                                <span class="live-dot"></span>LIVE
                            </div>
                        ` : ''}
                    </div>

                    <div class="p-5 flex flex-col gap-3">
                        <div>
                            <h3 class="font-bold text-sm text-white line-clamp-1">${stream.name}</h3>
                            <div class="flex justify-between items-center mt-2">
                                <p class="text-[10px] text-slate-500 font-bold uppercase">${startTimePHT} PHT</p>
                                <p class="text-[10px] text-blue-400 font-mono">${stream.viewers} VIEWERS</p>
                            </div>
                        </div>

                        <button onclick="openPlayer('${stream.iframe}', '${stream.name}')" 
                            class="w-full py-3 rounded-lg font-black text-[11px] uppercase transition-all
                            ${isLive ? 'bg-blue-600 hover:bg-blue-500 text-white' : 'bg-white/5 text-slate-500 hover:bg-white/10'}">
                            ${isLive ? 'Watch Stream' : 'Event Scheduled'}
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function openPlayer(url, name) {
            document.getElementById('playing-name').innerText = name;
            document.getElementById('player-iframe').src = url;
            document.getElementById('player-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closePlayer() {
            document.getElementById('player-iframe').src = "";
            document.getElementById('player-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        fetchStreams();
    </script>
</body>
</html>
